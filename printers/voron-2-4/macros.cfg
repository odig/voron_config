# WARNING. DO NOT EDIT THIS FILE.
# To override settings from this file, you can copy and paste the relevant
# sections into your printer.cfg and change it there.

# Print macros. Call these from your slicer (custom g-code). 
# You can copy these to printer.cfg and modify them to your liking, or just use them as is.
# Read more here: https://rat-rig.github.io/V-CoreOS/#/slicers
[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode:
  {% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
  M117 Pre-heating extruder...
  # Wait for extruder to reach 150 so an inductive probe (if present) is at a predictable temp. 
  # Also allows the bed heat to spread a little, and softens any plastic that might be stuck to the nozzle.
  M104 S150
  TEMPERATURE_WAIT SENSOR=extruder MINIMUM=150
  {% endif %}
  M117 Level gantry...
  # Adjust bed tilt
  G32

# Add feature to load mesh on demand
[gcode_macro _START_PRINT_BED_MESH]
gcode:
  {% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
    BED_MESH_CALIBRATE PROFILE=ratos
  {% endif %}
  {% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'load' %}
    BED_MESH_PROFILE LOAD=ratos
  {% endif %}  

[gcode_macro G28] 
rename_existing: G28.1
gcode:
    status_homing
    G28.1 { rawparams }
    STATUS_READY

#[gcode_macro QUAD_GANTRY_LEVEL] 
#rename_existing: QUAD_GANTRY_LEVEL.1
#gcode:
#    STATUS_LEVELING
#    QUAD_GANTRY_LEVEL.1 { rawparams }
#    STATUS_OFF
#
#[gcode_macro BED_MESH_CALIBRATE] 
#rename_existing: BED_MESH_CALIBRATE.1
#gcode:
#    STATUS_MESHING
#    BED_MESH_CALIBRATE.1 { rawparams }
#    STATUS_OFF

[gcode_macro M190] 
rename_existing: M190.1
gcode:
    STATUS_HEATING
    M190.1 { rawparams }
    
[gcode_macro M109] 
rename_existing: M109.1
gcode:
    STATUS_HEATING
    M109.1 { rawparams }
    SET_NOZZLE_LEDS_ON

[gcode_macro M84] 
rename_existing: M84.1
gcode:
    STATUS_READY
    M84.1 { rawparams }
    STATUS_OFF
